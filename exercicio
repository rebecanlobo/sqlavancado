--1. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO VENDEDOR
-- COM MAIOR NÚMERO DE VENDAS (CONTAGEM), E QUE ESTAS VENDAS ESTEJAM
-- COM O STATUS CONCLUÍDA.

SELECT FV.CODIGOVENDEDOR, DV.NOMEVENDEDOR
FROM dw_rb.dim_vendedor dv
JOIN dw_rb.fato_vendas fv ON dv.codigovendedor = fv.codigovendedor
WHERE codigostatusvenda = '1'

-- 2. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO PRODUTO
-- MAIS VENDIDO ENTRE AS DATAS DE 2014-02-03 ATÉ 2018-02-02. AS COLUNAS
-- PRESENTES NO RESULTADO DEVEM SER CODIGOPRODUTO (CDPRO) E NOMEPRODUTO(NMPRO).
 SELECT dp.nomeproduto, dp.codigoproduto
 FROM dw_rb.dim_produto dp
 JOIN dw_rb.fato_vendas fv ON dp.codigoproduto = fv.codigoproduto
 WHERE datavenda between '2014-02-03' and '2018-02-02'
 AND quantidadevendas > 0 
 ORDER BY quantidadevendas DESC
 LIMIT 1;
 
 
 -- 3. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO CLIENTE
-- COM MAIOR GASTO NA LOJA. AS COLUNAS
-- PRESENTES NO RESULTADO DEVEM SER CODIGOCLIENTE (CDCLI), NOMECLIENTE (NMCLI) E GASTO,
-- ESTA ÚLTIMA REPRESENTANDO O SOMATÓRIO DAS VENDAS ATRIBUÍDAS AO CLIENTE.
 SELECT FV.CODIGOCLIENTE, DC.NOMECLIENTE,
 SUM((FV.VALORUNITARIOVENDA) * (FV.QUANTIDADEVENDAS)) AS GASTO 
 FROM DW_RB.FATO_VENDAS FV
 INNER JOIN DW_RB.DIM_CLIENTE DC ON FV.CODIGOCLIENTE = DC.CODIGOCLIENTE
 WHERE CODIGOSTATUSVENDA = 1
 GROUP BY FV.CODIGOCLIENTE, DC.NOMECLIENTE
 ORDER BY GASTO DESC
 LIMIT 1;

-- 4. APRESENTE A QUERY PARA LISTAR O CÓDIGO, NOME E DATA DE NASCIMENTO DOS DEPENDENTES DO VENDEDOR
-- COM MENOR VALOR TOTAL BRUTO EM VENDAS (SENDO DIFERENTE DE ZERO).  AS COLUNAS PRESENTES NO RESULTADO 
-- DEVEM SER CODIGODEPENDENTE (CDDEP), NOMEDEPENDENTE (NMDEP) E DATANASCIMENTO (DTNASC).
SELECT DP.CODIGODEPENDENTE, DP.DATANASCIMENTODEPENDENTE, DP.NOMEDEPENDENTE
FROM DW.DIM_DEPENDENTE DP
JOIN DW.FATO_VENDAS FV ON DP.CODIGOVENDEDOR = FV.CODIGOVENDEDOR
AND VALORTOTALVENDA > 0
ORDER BY VALORTOTALVENDA ASC 
SUM((FV.VALORUNITARIOVENDA) * (FV.QUANTIDADEVENDAS)) AS VALORBRUTOTAL;


-- 5. APRESENTE A QUERY PARA LISTAR OS 3 PRODUTOS MENOS VENDIDOS, PELOS CANAIS DE E-COMMERCE OU MATRIZ.
-- AS COLUNAS PRESENTES NO RESULTADO DEVEM SER CANALVENDAS (CANAL), CODIGOPRODUTO (CDPRO), NOMEPRODUTO (NMPRO),
-- E QUANTIDADE_VENDAS.
SELECT DP.NOMEPRODUTO, DP.CODIGOPRODUTO, FV.CODIGOCANAL, FV.QUANTIDADEVENDAS
FROM DW.DIM_PRODUTO DP
JOIN DW.FATO_VENDAS FV ON DP.CODIGOPRODUTO = FV.CODIGOPRODUTO
WHERE CODIGOCANAL = 1 OR CODIGOCANAL = 2
ORDER BY QUANTIDADEVENDAS ASC
LIMIT 3;








--1. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO VENDEDOR
-- COM MAIOR NÚMERO DE VENDAS (CONTAGEM), E QUE ESTAS VENDAS ESTEJAM
-- COM O STATUS CONCLUÍDA.

SELECT FV.CODIGOVENDEDOR, DV.NOMEVENDEDOR
FROM dw_rb.dim_vendedor dv
JOIN dw_rb.fato_vendas fv ON dv.codigovendedor = fv.codigovendedor
WHERE codigostatusvenda = '1'

-- 2. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO PRODUTO
-- MAIS VENDIDO ENTRE AS DATAS DE 2014-02-03 ATÉ 2018-02-02. AS COLUNAS
-- PRESENTES NO RESULTADO DEVEM SER CODIGOPRODUTO (CDPRO) E NOMEPRODUTO(NMPRO).
 SELECT dp.nomeproduto, dp.codigoproduto
 FROM dw_rb.dim_produto dp
 JOIN dw_rb.fato_vendas fv ON dp.codigoproduto = fv.codigoproduto
 WHERE datavenda between '2014-02-03' and '2018-02-02'
 AND quantidadevendas > 0 
 ORDER BY quantidadevendas DESC
 LIMIT 1;
 
 
 -- 3. APRESENTE A QUERY PARA LISTAR O CÓDIGO E O NOME DO CLIENTE
-- COM MAIOR GASTO NA LOJA. AS COLUNAS
-- PRESENTES NO RESULTADO DEVEM SER CODIGOCLIENTE (CDCLI), NOMECLIENTE (NMCLI) E GASTO,
-- ESTA ÚLTIMA REPRESENTANDO O SOMATÓRIO DAS VENDAS ATRIBUÍDAS AO CLIENTE.
 SELECT FV.CODIGOCLIENTE, DC.NOMECLIENTE,
 (FV.VALORUNITARIOVENDA) * (FV.QUANTIDADEVENDAS) AS GASTO 
 FROM DW.FATO_VENDAS FV
 INNER JOIN DW.DIM_CLIENTE DC ON FV.CODIGOCLIENTE = DC.CODIGOCLIENTE
 WHERE CODIGOSTATUSVENDA = 1
 GROUP BY FV.CODIGOCLIENTE, DC.NOMECLIENTE, GASTO
 ORDER BY GASTO DESC
 LIMIT 1;

-- 4. APRESENTE A QUERY PARA LISTAR O CÓDIGO, NOME E DATA DE NASCIMENTO DOS DEPENDENTES DO VENDEDOR
-- COM MENOR VALOR TOTAL BRUTO EM VENDAS (SENDO DIFERENTE DE ZERO).  AS COLUNAS PRESENTES NO RESULTADO 
-- DEVEM SER CODIGODEPENDENTE (CDDEP), NOMEDEPENDENTE (NMDEP) E DATANASCIMENTO (DTNASC).
SELECT DP.CODIGODEPENDENTE, DP.DATANASCIMENTODEPENDENTE, DP.NOMEDEPENDENTE,
(FV.VALORUNITARIOVENDA) * (FV.QUANTIDADEVENDAS) AS VALORTOTALVENDA
FROM DW.DIM_DEPENDENTE DP
JOIN DW.FATO_VENDAS FV ON DP.CODIGOVENDEDOR = FV.CODIGOVENDEDOR
AND VALORTOTALVENDA > 0
ORDER BY VALORTOTALVENDA ASC 

-- 5. APRESENTE A QUERY PARA LISTAR OS 3 PRODUTOS MENOS VENDIDOS, PELOS CANAIS DE E-COMMERCE OU MATRIZ.
-- AS COLUNAS PRESENTES NO RESULTADO DEVEM SER CANALVENDAS (CANAL), CODIGOPRODUTO (CDPRO), NOMEPRODUTO (NMPRO),
-- E QUANTIDADE_VENDAS.
SELECT DISTINCT DP.CODIGOPRODUTO, DP.NOMEPRODUTO, FV.CODIGOCANAL, FV.QUANTIDADEVENDAS
FROM DW.FATO_VENDAS FV
JOIN (
SELECT DISTINCT DP.CODIGOPRODUTO, DP.NOMEPRODUTO
	FROM DW.DIM_PRODUTO DP) DP ON FV.CODIGOPRODUTO = DP.CODIGOPRODUTO
WHERE CODIGOCANAL = 1 OR CODIGOCANAL = 2
ORDER BY QUANTIDADEVENDAS ASC
LIMIT 3;

-- 6. APRESENTE  A QUERY PARA LISTAR O GASTO MÉDIO POR ESTADO DA FEDERAÇÃO. AS COLUNAS PRESENTES NO RESULTADO 
-- DEVEM SER ESTADO E GASTOMEDIO.
SELECT CL.ESTADOCLIENTE,
AVG (FV.VALORUNITARIOVENDA) * (FV.QUANTIDADEVENDAS) AS GASTOMEDIO
FROM DW.DIM_CLIENTE CL
JOIN DW.FATO_VENDAS FV ON CL.CODIGOCLIENTE = FV.CODIGOCLIENTE
GROUP BY CL.ESTADOCLIENTE, FV.QUANTIDADEVENDAS


-- 7. APRESENTE A QUERY PARA LISTAR O CÓDIGO DAS VENDAS (CDVEN) IDENTIFICADAS COMO DELETADAS. APRESENTE O 
-- RESULTADO EM ORDEM CRESCENTE.
SELECT FV.DELETADO
FROM DW.FATO_VENDAS FV
ORDER BY DELETADO ASC;

-- 8. APRESENTE A QUERY PARA LISTAR A QUANTIDADE MÉDIA VENDIDA DE CADA PRODUTO AGRUPADO POR ESTADO DA FEDERAÇÃO.
-- AS COLUNAS PRESENTES NO RESULTADO DEVEM SER ESTADO, NOMEPRODUTO E QUANTIDADEMEDIA. CONSIDERE ARREDONDAR 
-- O VALOR DA COLUNA QUANTIDADEMEDIA NA QUARTA CASA DECIMAL. ORDENE OS RESULTADOS PELO ESTADO (1°) E NOMEPRODUTO (2°).
SELECT CL.ESTADOCLIENTE,
AVG (FV.QUANTIDADEVENDAS) AS QUANTIDADEMEDIA
FROM DW.DIM_CLIENTE CL
JOIN DW.FATO_VENDAS FV ON CL.CODIGOCLIENTE = FV.CODIGOCLIENTE
WHERE CODIGOPRODUTO = (
  SELECT CODIGOPRODUTO
  FROM DW.DIM_PRODUTO PD
  GROUP BY PD.CODIGOPRODUTO
  ORDER BY FV.QUANTIDADEVENDAS DESC
  LIMIT 1)

-- 9. CALCULE A RECEITA BRUTA POR ANO.
SELECT SUM ((QUANTIDADEVENDAS) * (VALORUNITARIOVENDA)) AS RECEITABRUTA
FROM DW.FATO_VENDAS
WHERE CODIGOSTATUSVENDA = 1

--10. CALCULE A RECEITA BRUTA POR ANO E POR ESTADO.
SELECT SUM ((QUANTIDADEVENDAS) * (VALORUNITARIOVENDA)) AS RECEITABRUTA,
ESTADOCLIENTE AS ESTADO
FROM DW.FATO_VENDAS FV
JOIN DW.DIM_CLIENTE CL ON FV.CODIGOCLIENTE = CL.CODIGOCLIENTE
WHERE CODIGOSTATUSVENDA = 1
GROUP BY ESTADOCLIENTE

-- 11. PROPONHA UM INDICADOR:
-- APRESENTE A QUERY PARA LISTAR O VENDEDOR COM MAIOR RECEITA BRUTA. AS COLUNAS 
-- PRESENTES NO RESULTADO DEVEM SER NOMEVENDEDOR, CODIGOVENDEDOR E RECEITABRUTA.
SELECT VD.NOMEVENDEDOR, VD.CODIGOVENDEDOR,
SUM ((QUANTIDADEVENDAS) * (VALORUNITARIOVENDA)) AS RECEITABRUTA
FROM DW.DIM_VENDEDOR VD
JOIN DW.FATO_VENDAS FV ON VD.CODIGOVENDEDOR = FV.CODIGOVENDEDOR
GROUP BY VD.NOMEVENDEDOR, VD.CODIGOVENDEDOR
LIMIT 1

-- 12. MONTE UMA VIEW PARA A QUERY DA QUESTÃO 5.
SELECT DISTINCT DP.CODIGOPRODUTO, DP.NOMEPRODUTO, FV.CODIGOCANAL, FV.QUANTIDADEVENDAS
FROM DW.FATO_VENDAS FV
JOIN (
SELECT DISTINCT DP.CODIGOPRODUTO, DP.NOMEPRODUTO
	FROM DW.DIM_PRODUTO DP) DP ON FV.CODIGOPRODUTO = DP.CODIGOPRODUTO
WHERE CODIGOCANAL = 1 OR CODIGOCANAL = 2
ORDER BY QUANTIDADEVENDAS ASC
LIMIT 3;
